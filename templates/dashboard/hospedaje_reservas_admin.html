{% extends 'dashboard/base.html' %}

{% block content %}
<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Reservas de Hospedaje</h4>
    <form class="d-flex" method="get">
      <select class="form-select" name="estado" onchange="this.form.submit()">
        <option value="">Todos</option>
        {% for st in ['Activa','Completada','Cancelada'] %}
          <option value="{{ st }}" {% if estado==st %}selected{% endif %}>{{ st }}</option>
        {% endfor %}
      </select>
    </form>
  </div>
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Habitaci√≥n</th>
          <th>Check-in</th>
          <th>Check-out</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Ticket</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reservas %}
        <tr>
          <td>#{{ r.id }}</td>
          <td>{{ r.usuario_id }}</td>
          <td>{{ r.habitacion_id }}</td>
          <td>{{ r.check_in }}</td>
          <td>{{ r.check_out or '-' }}</td>
          <td>${{ '{:,.0f}'.format(r.total or 0) }} COP</td>
          <td>
            <span class="badge text-bg-{% if r.estado=='Completada' %}success{% elif r.estado=='Cancelada' %}danger{% else %}warning{% endif %}">{{ r.estado }}</span>
          </td>
          <td>
            {% set t = tickets.get(r.id) %}
            {% if r.estado=='Completada' %}
              <a class="btn btn-sm btn-outline-primary" href="{{ url_for('admin.hospedaje_reserva_ticket', reserva_id=r.id) }}">Descargar</a>
            {% elif t %}
              <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin.hospedaje_reserva_ticket', reserva_id=r.id) }}">Descargar</a>
            {% else %}
              <span class="text-muted small">No disponible</span>
            {% endif %}
          </td>
          <td>
            <form method="post" action="{{ url_for('admin.hospedaje_reserva_estado', reserva_id=r.id) }}" class="d-flex gap-2">
              <select class="form-select form-select-sm" name="estado">
                {% for st in ['Activa','Completada','Cancelada'] %}
                <option value="{{ st }}" {% if r.estado==st %}selected{% endif %}>{{ st }}</option>
                {% endfor %}
              </select>
              <button class="btn btn-sm btn-outline-success">Guardar</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="8" class="text-muted">No hay reservas</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
