{% extends 'home/base.html' %}

{% block title %}Experiencias{% endblock %}

{% block content %}
<br>
<div class="container mt-5">
    <!-- Header personalizado -->
    <div class="p-3 p-md-4 bg-white rounded-4 shadow-sm mb-4 d-flex align-items-center">
        {% set _user = session.get('user') %}
        {% set _avatar = _user.get('avatar') if _user else None %}
        <div class="me-3" style="width:48px;height:48px;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#eef2f7;">
            {% if _avatar %}
                <img src="{{ url_for('static', filename=_avatar) if not _avatar.startswith('http') else _avatar }}" alt="Avatar" style="width:100%;height:100%;object-fit:cover;"/>
            {% else %}
                <i class="bi bi-person-circle" style="font-size:1.8rem;color:#64748b;"></i>
            {% endif %}
        </div>
        <div>
            <h3 class="mb-1">Hola{{ ' ' + (_user.nombre or _user.usuario) if _user else '' }},</h3>
            <div class="text-muted">Estas son las nuevas experiencias de nuestros huéspedes</div>
        </div>
    </div>

    <!-- Formulario de comentario (estilo mejorado) -->
    <div class="p-3 p-md-4 bg-white rounded-4 shadow-sm mb-4">
        <div class="d-flex align-items-center mb-3">
            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                <i class="fas fa-comment text-white"></i>
            </div>
            <h5 class="mb-0">Comparte tu experiencia</h5>
        </div>

        {% if current_user.is_authenticated %}
        <form method="POST" action="{{ url_for('experiencias') }}">
            <div class="mb-3">
                <label class="form-label">Tu nombre</label>
                <input type="text" class="form-control" name="nombre" value="{{ (_user.nombre or _user.usuario) if _user else '' }}" readonly>
            </div>
            <div class="mb-3">
                <label for="rating" class="form-label">Tu calificación</label>
                <div class="star-rating">
                    <input type="radio" id="star5" name="rating" value="5" required>
                    <label for="star5" title="5 estrellas">★</label>
                    <input type="radio" id="star4" name="rating" value="4">
                    <label for="star4" title="4 estrellas">★</label>
                    <input type="radio" id="star3" name="rating" value="3">
                    <label for="star3" title="3 estrellas">★</label>
                    <input type="radio" id="star2" name="rating" value="2">
                    <label for="star2" title="2 estrellas">★</label>
                    <input type="radio" id="star1" name="rating" value="1">
                    <label for="star1" title="1 estrella">★</label>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Tu comentario</label>
                <textarea class="form-control" name="contenido" rows="4" placeholder="Cuéntanos qué te pareció el servicio, la atención y tu experiencia general..." required></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-paper-plane me-2"></i>
                Publicar experiencia
            </button>
        </form>
        {% else %}
            <div class="alert alert-info">
                Para compartir una experiencia, por favor <a href="{{ url_for('registro.login', next=request.full_path) }}">inicia sesión</a> o crea una cuenta.
            </div>
        {% endif %}
    </div>

    <!-- Reviews reales (dinámicas) con estilo unificado -->
    <div class="mt-4">
        {% if comentarios %}
        <div class="reviews-grid">
            {% for comentario in comentarios %}
                {% set rating = comentario.rating|default(comentario.puntuacion|default(0))|int %}
                <div class="review-card">
                    <div class="rc-body">
                        <div class="rc-top">
                            <span class="rating-badge">{{ '%.1f' % (rating|float) if rating is number else rating }}</span>
                            <div class="stars">
                                {% for i in range(1,6) %}
                                    {% if i <= rating %}★{% else %}☆{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        <p class="rc-text">{{ comentario.contenido }}</p>
                    </div>
                    <div class="rc-footer">
                        {% if comentario.user and comentario.user.avatar %}
                            <img src="{{ comentario.user.avatar }}" class="avatar" alt="avatar" onerror="this.style.display='none'">
                        {% else %}
                            <div class="avatar">{{ (comentario.user.username[0] if comentario.user and comentario.user.username else 'U') }}</div>
                        {% endif %}
                        <div>
                            <div class="fw-semibold small">{{ comentario.user.username if comentario.user else 'Usuario' }}</div>
                            {% if comentario.created_at %}
                                <div class="meta">{{ comentario.created_at.strftime('%b %Y') }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        {% else %}
            <div class="text-center py-4 text-muted">Aún no hay experiencias publicadas.</div>
        {% endif %}
    </div>

    

    <!-- Gallery Section -->
    <section class="mt-5 mb-5">
        <div class="text-center mb-4">
            <h3>Galería de Momentos</h3>
        </div>
        
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card mb-3">
                    <img id="mainImage" src="{{ url_for('static', filename='img/r1.jpg') }}" class="img-fluid rounded" style="width:100%;height:480px;object-fit:cover;">
                    <div class="mt-2 d-flex gap-2 overflow-auto p-2">
                        {% set gallery_imgs = ['r1.jpg','r2.jpg','r3.jpg','r4.jpg','r5.jpg','r6.jpg','habitacion(1).jpg','habitacion(2).jpg','habitacion(3).jpg','e1.jpg'] %}
                        {% for img in gallery_imgs %}
                            <img src="{{ url_for('static', filename='img/' + img) }}" class="img-thumbnail thumb" style="width:110px;height:70px;object-fit:cover;cursor:pointer;" onclick="document.getElementById('mainImage').src=this.src;">
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="row">
                    <div class="col-6 mb-3">
                        <div class="card text-center p-3">
                            <div class="mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-utensils text-primary" viewBox="0 0 16 16">
                                    <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v6.086a1.5 1.5 0 0 1-.436 1.06l-.671.671a.5.5 0 1 1-.708-.707l.671-.671A.5.5 0 0 0 6 8.5V2.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .146.354l.854.853a.5.5 0 0 1-.708.707L1.146 9.061A1.5 1.5 0 0 1 1 8.5V2.5zm8.5-1A1.5 1.5 0 0 0 8 2.5v5.793c0 .398.158.78.44 1.06l1.768 1.768a.5.5 0 0 0 .707-.707L9.147 8.646A.5.5 0 0 1 9 8.293V2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.146.354l-.854.853a.5.5 0 1 0 .708.707l.854-.853A1.5 1.5 0 0 0 14 8.5v-6A1.5 1.5 0 0 0 12.5 1h-3z"/>
                                </svg>
                            </div>
                            <h6>Terraza Principal</h6>
                            <p class="small text-muted">Disfruta de una comida</p>
                        </div>
                    </div>
                    
                    <div class="col-6 mb-3">
                        <div class="card text-center p-3">
                            <div class="mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-water text-info" viewBox="0 0 16 16">
                                    <path d="M.036 3.314a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 3.964a.5.5 0 0 1-.278-.65zm0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 6.964a.5.5 0 0 1-.278-.65zm0 3a.5.5 0 0 1 .65-.278l1.757.703a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.014-.406a2.5 2.5 0 0 1 1.857 0l1.015.406a1.5 1.5 0 0 0 1.114 0l1.757-.703a.5.5 0 1 1 .372.928l-1.758.703a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0l-1.014-.406a1.5 1.5 0 0 0-1.114 0l-1.015.406a2.5 2.5 0 0 1-1.857 0L.314 9.964a.5.5 0 0 1-.278-.65z"/>
                                </svg>
                            </div>
                            <h6>Gastronomía Selecta</h6>
                            <p class="small text-muted">Platos de autor</p>
                        </div>
                    </div>
                    
                    <div class="col-6 mb-3">
                        <div class="card text-center p-3">
                            <div class="mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-sun text-warning" viewBox="0 0 16 16">
                                    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
                                </svg>
                            </div>
                            <h6>Postres Artesanales</h6>
                            <p class="small text-muted">Creaciones dulces únicas</p>
                        </div>
                    </div>
                    
                    <div class="col-6 mb-3">
                        <div class="card text-center p-3">
                            <div class="mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-cup-hot text-danger" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M.5 6a.5.5 0 0 0-.488.608l1.652 7.434A2.5 2.5 0 0 0 4.104 16h5.792a2.5 2.5 0 0 0 2.44-1.958l.131-.59a3 3 0 0 0 1.3-5.854l.221-.99A.5.5 0 0 0 13.5 6H.5ZM13 12.5a2.01 2.01 0 0 1-.316-.025l.867-3.898A2.001 2.001 0 0 1 13 12.5ZM2.64 13.825 1.123 7h11.754l-.81 3.654a1.5 1.5 0 0 1-1.478 1.187H4.104a1.5 1.5 0 0 1-1.464-1.216Z"/>
                                    <path d="m4.4.8-.003.004-.014.019a4.167 4.167 0 0 0-.204.31 2.327 2.327 0 0 0-.141.267c-.026.06-.034.092-.037.103v.004a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.071.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103v.004a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.07.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.07.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.07.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103v.004a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.071.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103v.004a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.07.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.071.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.522.633c-.036.06-.04.091-.042.103v.004a.593.593 0 0 0 .091.248c.075.133.178.272.308.445l.01.012c.118.158.26.347.37.543.112.202.212.417.254.66.037.21.031.427-.048.632-.07.18-.17.335-.254.447a3.88 3.88 0 0 1-.604.598l-.048.04c-.131.104-.248.19-.379.29a2.282 2.282 0 0 0-.499.605c-.048.074-.048.074-.048.075A.5.5 0 0 0 4.5.8a.5.5 0 0 0-.1-.8Z"/>
                                </svg>
                            </div>
                            <h6>Cocteles Premium</h6>
                            <p class="small text-muted">Bebidas especializadas</p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <h5>Vive Tu Propia Experiencia</h5>
                    <p class="text-muted small">Únete a los cientos de huéspedes que han disfrutado de momentos inolvidables con nosotros. Reserva ahora y descubre por qué somos la elección preferida.</p>
                    <a href="{{ url_for('hospedaje') }}" class="btn btn-primary me-2">Reservar Ahora</a>
                    <a href="#" class="btn btn-outline-secondary">Ver Menú</a>
                </div>
            </div>
        </div>
    </section>



                
            
        </div>
    </div>
    </form>
</div>

<style>
.star-rating { direction: rtl; display: inline-flex; flex-direction: row-reverse; }
.star-rating input[type="radio"] { display: none; }
.star-rating label { color: #ddd; font-size: 2rem; cursor: pointer; transition: color .2s; }
.star-rating input[type="radio"]:checked ~ label,
.star-rating label:hover,
.star-rating label:hover ~ label { color: #ffc107; }
</style>

{% endblock %}