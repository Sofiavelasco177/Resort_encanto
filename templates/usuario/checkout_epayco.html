{% extends 'usuario/base.html' %}

{% block content %}
<div class="checkout-page container py-5">
  <div class="checkout-header mb-3">
    <h1 class="title">Confirmar pago</h1>
    <div class="chips">
      <span class="chip">Reserva #{{ reserva.id }}</span>
      <span class="chip">{{ reserva.check_in }} → {{ reserva.check_out }}</span>
    </div>
  </div>

  <div class="checkout-card">
    <div class="row g-4 align-items-center">
      <div class="col-md-7">
        <div class="summary">
          <div class="label">Habitación</div>
          <div class="value">{{ habitacion.nombre if habitacion else ('#'+(reserva.habitacion_id|string)) }}</div>
        </div>
        <div class="gateway-note">Se procesará en ePayco {{ 'Sandbox' if test=='true' else '' }}</div>
      </div>
      <div class="col-md-5 text-md-end">
        <div class="total-label">Total a pagar</div>
        <div class="total-amount">${{ '%.0f'|format(reserva.total or 0) }} COP</div>
      </div>
    </div>
    <hr class="my-3" />

    {% if not epayco_public_key %}
    <div class="alert alert-danger">Falta configurar EPAYCO_PUBLIC_KEY en el entorno.</div>
    {% endif %}

    <div class="pay-method">
      <div class="icon"><i class="bi bi-credit-card"></i></div>
      <div class="info">
        <div class="name">ePayco Payment Gateway</div>
        <div class="desc">Procesamiento seguro de pagos</div>
      </div>
    </div>
    <div class="pay-actions">
      <a href="{{ url_for('perfil_usuario.perfil') }}" class="btn btn-outline-secondary">Cancelar</a>
      <form id="epayco-form" onsubmit="return false;" class="d-inline">
        <script src="https://checkout.epayco.co/checkout.js"
          class="epayco-button"
          data-epayco-key="{{ epayco_public_key }}"
          data-epayco-amount="{{ '%.2f'|format(amount) }}"
          data-epayco-name="{{ title }}"
          data-epayco-description="{{ description }}"
          data-epayco-currency="{{ currency|upper }}"
          data-epayco-country="{{ country|upper }}"
          data-epayco-test="{{ test }}"
          data-epayco-invoice="{{ invoice }}"
          data-epayco-external="true"
          data-epayco-response="{{ response_url }}"
          data-epayco-confirmation="{{ confirm_url }}"
          data-epayco-autoclick="true">
        </script>
      </form>
    </div>
    <div class="sandbox-note">
      <i class="bi bi-info-circle me-1"></i> Modo de prueba disponible (EPAYCO_TEST=1).
    </div>
  </div>
</div>
{% endblock %}
