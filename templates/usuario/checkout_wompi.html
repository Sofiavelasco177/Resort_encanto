{% extends 'usuario/base.html' %}

{% block content %}
<div class="checkout-page container py-5">
  <div class="checkout-header mb-3">
    <h1 class="title">Confirmar pago</h1>
    <div class="chips">
      <span class="chip">Reserva #{{ reserva.id }}</span>
      <span class="chip">{{ reserva.check_in }} → {{ reserva.check_out }}</span>
    </div>
  </div>

  <div class="checkout-card">
    <div class="row g-4 align-items-center">
      <div class="col-md-7">
        <div class="summary">
          <div class="label">Habitación</div>
          <div class="value">{{ habitacion.nombre if habitacion else ('#'+(reserva.habitacion_id|string)) }}</div>
        </div>
        <div class="gateway-note">Se procesará en Wompi (Sandbox)</div>
      </div>
      <div class="col-md-5 text-md-end">
        <div class="total-label">Total a pagar</div>
        <div class="total-amount">${{ '%.0f'|format(reserva.total or 0) }} COP</div>
      </div>
    </div>
    <hr class="my-3" />

    {% if not wompi_public_key %}
    <div class="alert alert-danger">Falta configurar WOMPI_PUBLIC_KEY en el entorno.</div>
    {% endif %}

    <div class="pay-method">
      <div class="icon"><i class="bi bi-credit-card"></i></div>
      <div class="info">
        <div class="name">Wompi Payment Gateway</div>
        <div class="desc">Procesamiento seguro de pagos</div>
      </div>
    </div>
    <div class="pay-actions">
      <a href="{{ url_for('perfil_usuario.perfil') }}" class="btn btn-outline-secondary">Cancelar</a>
      <form method="POST" onsubmit="return false;" class="d-inline">
        <script src="https://checkout.wompi.co/widget.js"
                data-render="button"
                data-public-key="{{ wompi_public_key }}"
                data-currency="{{ currency }}"
                data-amount-in-cents="{{ amount_in_cents }}"
                data-reference="{{ reference }}"
                data-redirect-url="{{ redirect_url }}"
                data-country="{{ country|default('CO') }}">
        </script>
      </form>
    </div>
    <div class="sandbox-note">
      <i class="bi bi-info-circle me-1"></i> Modo de prueba (Sandbox). No se realizan cobros reales.
    </div>
  </div>
</div>
{% endblock %}
